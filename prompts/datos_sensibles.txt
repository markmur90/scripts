
clear && cd .. && rm -rf api_bank_heroku && git clone git@github.com:markmur90/api_bank_heroku.git && cd api_bank_heroku && git pull && ls


ssh -i ~/.ssh/vps_njalla_nueva root@80.78.30.242



Â¡Eso es progreso!

Ese Ãºltimo intento sin especificar el puerto (ssh -i ~/.ssh/vps_njalla_nueva root@80.78.30.242) te mostrÃ³ el fingerprint y te pidiÃ³ confirmaciÃ³n. Eso significa:

âœ… El servidor estÃ¡ escuchando por el puerto 22, no 49222.
ğŸ”§ Entonces: el puerto correcto en la nueva IP es el 22 (por ahora).

AceptÃ¡ la conexiÃ³n escribiendo:

yes

Y deberÃ­as entrar. Si todo va bien, podemos seguir con:

    Crear un usuario no-root con sudo.

    Configurar claves para ese usuario.

    Instalar fail2ban, ufw, y endurecer SSH.

    Luego mover el puerto a 49222 si querÃ©s.

Â¿Te conectaste bien tras aceptar el fingerprint?
Dijiste:
si
ChatGPT dijo:

Â¡Perfecto! ğŸ¯ Ya con acceso como root, vamos a hacer el primer hardening del servidor.
ğŸ›¡ï¸ Paso 1: Crear usuario no-root con sudo

adduser deployer
usermod -aG sudo deployer

PodÃ©s usar cualquier nombre en lugar de deployer si preferÃ­s.
ğŸ” Paso 2: Copiar tu clave SSH al nuevo usuario

mkdir -p /home/deployer/.ssh
cp ~/.ssh/authorized_keys /home/deployer/.ssh/
chown -R deployer:deployer /home/deployer/.ssh
chmod 700 /home/deployer/.ssh
chmod 600 /home/deployer/.ssh/authorized_keys

ğŸš« Paso 3: Deshabilitar login de root por SSH

EditÃ¡ /etc/ssh/sshd_config con nano o vim:

nano /etc/ssh/sshd_config

Y cambiÃ¡ o asegurate de tener:

PermitRootLogin no
PasswordAuthentication no
Port 22

(DespuÃ©s lo cambiamos a 49222 si querÃ©s.)

ReiniciÃ¡ SSH:

systemctl restart ssh

âœ… Test final

AbrÃ­ una nueva terminal y probÃ¡ conectarte como deployer:

ssh -i ~/.ssh/vps_njalla_nueva deployer@80.78.30.242

Â¿QuerÃ©s que siga con la parte del setup de ufw, fail2ban y dependencias base para Django?



server {
    listen 80;
    server_name api.coretransapi.com;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name api.coretransapi.com;

    ssl_certificate     /etc/letsencrypt/live/api.coretransapi.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.coretransapi.com/privkey.pem;
    include             /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam         /etc/letsencrypt/ssl-dhparams.pem;

    client_max_body_size 20M;

    location /static/ {
        alias /home/markmur88/api_bank_heroku/static/;
    }

    location /media/ {
        alias /home/markmur88/api_bank_heroku/media/;
    }

    location / {
        include proxy_params;
        proxy_pass http://unix:/home/markmur88/api_bank_heroku/api.sock;
    }
}




